#- unit testy i integracyjny
#- dockercompose - testy akcepytacyjne

#! być może zrobić unittesty w trakcie budowania


name: Continuous Integration

on:
  pull_request:
    branches:
      - master

jobs:
  Tests:
    runs-on: ubuntu-latest
    steps:
        - name: Checkout
          uses: actions/checkout@v2
          # get tests log out
        - name: Installing dependencies for test and build phase
          run: docker build --tag nice_project_tests --target build  nice_project
        - name: Unit and integration tests of nice_project
          run: docker run nice_project_tests python -m unittest
        - name: Building release image
          run: docker-compose up nginx
        - name: Acceptance tests
          run: |
            docker-compose up
            docker-compose down
          env:
            NGINX_LISTEN_PORT: 5002
            NICE_PROJECT_PORT: 5001
            SERVICE_PORT: 5000